[{"title":"åŠ¨æ€ä»£ç†","url":"/2021/02/14/åŠ¨æ€ä»£ç†/","content":"## å¯ä»¥å¹²ä»€ä¹ˆ\n\n- å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ç±»çš„åŸºç¡€ä¸ŠåŠ¨æ€ä¸ºé€šè¿‡è¯¥ç±»è·å–çš„å¯¹è±¡æ·»åŠ æ–¹æ³•ã€ä¿®æ”¹è¡Œä¸ºï¼ˆå¢å¼ºï¼‰\n- åŠ¨æ€ä»£ç†æ˜¯å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹AOPçš„åŸºç¡€\n- AOPå¯ä»¥å¹²ä»€ä¹ˆï¼Ÿ\n    - æ—¥å¿—ã€æ€§èƒ½ç›‘æ§ã€æƒé™æ£€æŸ¥ã€æ•°æ®åº“äº‹åŠ¡\n    - AOPåˆ‡é¢é€šè¿‡å°†åˆ‡é¢é€»è¾‘å’Œä¸»ä½“é€»è¾‘åˆ†ç¦»ï¼Œä½¿ä»£ç æ›´ä¼˜é›…ï¼Œå¯¹ä»£ç ä¾µå…¥ä½\n\n## ä»€ä¹ˆæ˜¯ä»£ç†\n\nå’Œç”Ÿæ´»ä¸­çš„ä»£ç†çš„æ„æ€ç±»ä¼¼ã€‚ä¸€èˆ¬è‡³å°‘æœ‰ä¸€ä¸ªå®é™…å¯¹è±¡ï¼Œ\nä»£ç†çš„å¤–éƒ¨åŠŸèƒ½å’Œå®é™…å¯¹è±¡ä¸€èˆ¬æ˜¯ä¸€æ ·çš„ï¼Œç”¨æˆ·ä¸ä»£ç†æ‰“äº¤é“ï¼Œä¸ç›´æ¥æ¥è§¦å®é™…å¯¹è±¡ã€‚\n\n## ä»£ç†å­˜åœ¨çš„ä»·å€¼\n\n- èŠ‚çœæˆæœ¬ï¼Œå®é™…å¯¹è±¡åˆ›å»ºçš„æˆæœ¬å¼€é”€å¤§ï¼ŒæŒ‰éœ€å»¶è¿ŸåŠ è½½ï¼Œ\n  åˆ›å»ºä»£ç†æ—¶å¹¶ä¸çœŸæ­£åˆ›å»ºå®é™…å¯¹è±¡ï¼Œè€Œåªæ˜¯ä¿å­˜å®é™…å¯¹è±¡çš„åœ°å€ï¼Œåœ¨éœ€è¦æ—¶å†åŠ è½½æˆ–åˆ›å»º\n- æ‰§è¡Œæƒé™æ£€æŸ¥ï¼Œä»£ç†æ£€æŸ¥æƒé™åï¼Œå†è°ƒç”¨å®é™…å¯¹è±¡\n- å±è”½ç½‘ç»œå·®å¼‚å’Œå¤æ‚æ€§ï¼Œä»£ç†åœ¨æœ¬åœ°ï¼Œè€Œå®é™…å¯¹è±¡åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šï¼Œè°ƒç”¨æœ¬åœ°ä»£ç†æ—¶ï¼Œæœ¬åœ°ä»£ç†è¯·æ±‚å…¶ä»–æœåŠ¡å™¨\n\n## é™æ€ä»£ç†\n\n- ä¸šåŠ¡æ¥å£ã€å®é™…ç±»ã€ä»£ç†ç±»\n\n- å®é™…ç±»å®ç°ä¸šåŠ¡æ¥å£ï¼Œå®ç°æ¥å£ä¸­çš„æ–¹æ³•\n- ä»£ç†ç±»ä¹Ÿå®ç°ä¸šåŠ¡æ¥å£ï¼Œå¹¶ç»´æŒä¸€ä¸ªä¸šåŠ¡æ¥å£å®ç°ç±»çš„å¼•ç”¨ï¼Œé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥å®é™…ç±»çš„å¼•ç”¨ï¼Œ\n  å®ç°çš„æ–¹æ³•ä¸­å®é™…è°ƒç”¨çš„æ˜¯å®é™…ç±»çš„æ–¹æ³•\n    - å¯ä»¥åœ¨è°ƒç”¨å®é™…æ–¹æ³•çš„å‰åï¼Œåšå¢å¼ºé€»è¾‘ï¼Œæ¯”å¦‚åœ¨è°ƒç”¨å‰åè¾“å‡ºæ—¥å¿—\n- é™æ€ä»£ç†çš„ä»£ç†ç±»ï¼Œæ˜¯åœ¨å†™ä»£ç æ—¶å°±å›ºå®šçš„ï¼Œæ‰€ä»¥ç§°ä¸ºé™æ€ä»£ç†\n- è¾“å‡ºè·Ÿè¸ªè°ƒè¯•ä¿¡æ¯æ˜¯ä¸€ä¸ªé€šç”¨éœ€æ±‚ï¼Œé™æ€ä»£ç†åªèƒ½ä¸ºæŸä¸ªç±»å¢å¼ºï¼Œè¦ä¸ºæŸäº›ç±»å¢å¼ºï¼Œåªèƒ½æ¯ä¸ªç±»éƒ½å†™ä¸€ä¸ªä»£ç†ç±»ï¼Œä¸ç°å®ã€‚è¿™å°±éœ€è¦åŠ¨æ€ä»£ç†äº†ã€‚\n\n## å’Œé€‚é…å™¨ã€è£…é¥°å™¨çš„åŒºåˆ«\n\n- é€‚é…å™¨\n    - é€‚é…å™¨æä¾›äº†ä¸€ä¸ªä¸ä¸€æ ·çš„æ–°æ¥å£\n- è£…é¥°å™¨\n    - è£…é¥°å™¨æ˜¯å¯¹åŸæ¥å£èµ·åˆ°äº†è£…é¥°çš„ä½œç”¨ï¼Œå¯èƒ½å¢åŠ äº†æ–°æ¥å£ã€ä¿®æ”¹äº†åŸæœ‰çš„è¡Œä¸ºç­‰ï¼Œä»£ç†ä¸€èˆ¬ä¸æ”¹å˜æ¥å£\n\næˆ‘ä»¬ä¸è¿‡äºå¼ºè°ƒä»–ä»¬çš„å·®åˆ«ï¼Œæ²¡æœ‰äº‰è®ºçš„æ„ä¹‰ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä»£ç†çš„ä¸€ç§å˜ä½“\n\n## ä»€ä¹ˆæ˜¯åŠ¨æ€ä»£ç†\n\nä»£ç†ç±»æ˜¯è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ã€‚\n\næ€ä¹ˆåŠ¨æ€ç”Ÿæˆï¼Ÿ\n\n## åŠ¨æ€ä»£ç†çš„ä¸¤ç§æ–¹å¼\n\n### JDKæä¾›çš„\n\n#### å®ç°InvocationHandlerçš„æ¥å£ï¼Œå®ç°å…¶invokeæ–¹æ³•ï¼Œè¿™å°±æ˜¯å®ç°å¢å¼ºé€»è¾‘\n\ninvokeæ–¹æ³•ï¼Œä¸‰ä¸ªå‚æ•°\n\n- proxyï¼Œä»£ç†å¯¹è±¡æœ¬èº«ï¼Œä¸€èˆ¬ä¸ç”¨\n- methodï¼Œæ­£åœ¨è¢«è°ƒç”¨çš„æ–¹æ³•\n- argsï¼Œè¡¨ç¤ºæ–¹æ³•çš„å‚æ•°\n\n#### æ€ä¹ˆåˆ›å»ºç±»\n\né€šè¿‡Proxy.newProxyInstanceï¼Œä¸‰ä¸ªå‚æ•°\n\n- classloaderç±»åŠ è½½å™¨\n- ä»£ç†ç±»è¦å®ç°çš„æ¥å£åˆ—è¡¨\n- å®ç°å¢å¼ºé€»è¾‘çš„ç±»ï¼Œå³å®ç°InvocationHandleræ¥å£çš„ç±»ï¼Œå¯¹ä»£ç†æ¥å£æ‰€æœ‰æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè½¬ç»™è¯¥æ–¹æ³•\n\nè¿”å›æŸä¸ªæ¥å£åˆ—è¡¨ä¸­çš„ç±»å‹ï¼Œåªèƒ½å¼ºè½¬ä¸ºæ¥å£ï¼Œä¸èƒ½æ˜¯å®ç°ç±»\n\n\n\n#### ç¤ºä¾‹\n\n```java\npublic class SimpleJDKDynamicProxyDemo {\n    interface IService {\n        void sayHello();\n    }\n\n    static class RealService implements IService {\n\n        @Override\n        public void sayHello() {\n            System.out.println(\"hello\");\n        }\n    }\n\n    static class SimpleInvocationHandler implements InvocationHandler {\n        private Object realObj;\n\n        public SimpleInvocationHandler(Object realObj) {\n            this.realObj = realObj;\n        }\n\n        @Override\n        public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n            System.out.println(\"entering \" + method.getName());\n            Object result = method.invoke(realObj, args);\n            System.out.println(\"leaving \" + method.getName());\n            return result;\n        }\n    }\n\n    public static void main(String[] args) {\n        IService realService = new RealService();\n        IService proxyService = (IService) Proxy.newProxyInstance(IService.class.getClassLoader(),\n                new Class<?>[] { IService.class }, new SimpleInvocationHandler(realService));\n        proxyService.sayHello();\n    }\n}\n```\n\n#### åŸºæœ¬åŸç†\n\nä¸Šé¢ä¾‹å­ç”Ÿæˆçš„ç±»å¦‚ä¸‹ï¼š\n\n![](https://gitee.com/jinxin.70/oss/raw/master/uPic/DbDyLN_2021_02_07_15_28_27.png)\n\nç”Ÿæˆçš„ç±»æ˜¯Proxyçš„å­ç±»ï¼Œç»“åˆProxyç±»çœ‹\n\n![](https://gitee.com/jinxin.70/oss/raw/master/uPic/HRFvbZ_2021_02_07_15_32_52.png)\n\nä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ$Proxy0çš„æ„é€ æ–¹æ³•ä¼ å…¥InvocationHandlerï¼Œæœ€ç»ˆèµ‹å€¼ç»™çˆ¶ç±»Proxyçš„å±æ€§hï¼Œåç»­çš„å…¶ä»–æ–¹æ³•è°ƒç”¨éƒ½è½¬å‘åˆ°è¿™ä¸ªInvocationHandlerçš„å­ç±»ä¸­ï¼Œæ¯”å¦‚ï¼ŒsayHelloæ–¹æ³•ï¼Œè°ƒç”¨çš„æ˜¯this.h.invoke(this, m3, null);å¯¹äºObjectä¸­çš„æ–¹æ³•ï¼Œå¦‚hashcodeã€equalså’ŒtoStringï¼Œ$Proxy0åŒæ ·è½¬å‘ç»™äº†InvocationHandler\n\næˆ‘ä»¬æ€ä¹ˆçŸ¥é“$Proxy0çš„å®šä¹‰çš„å‘¢ï¼Ÿå¯¹äºoracleçš„JVMï¼Œå¯ä»¥é…ç½®javaçš„ä¸€ä¸ªå±æ€§å¾—åˆ°ï¼Œæ¯”å¦‚\njava -Dsun.misc.ProxyGenerator.saveGeneratedFiles=true shuo.laoma.dynamic.c86.SimpleJDKDynamicProxyDemo\n\nä»¥ä¸Šå‘½ä»¤ä¼šæŠŠåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»$Proxy0ä¿å­˜åˆ°æ–‡ä»¶$Proxy0.classä¸­ï¼Œé€šè¿‡ä¸€äº›åç¼–è¯‘å™¨å·¥å…·æ¯”å¦‚JD-GUIï¼ˆhttp://jd.benow.caï¼‰å°±å¯ä»¥å¾—åˆ°æºç ã€‚\n\nç†è§£äº†ä»£ç†ç±»çš„å®šä¹‰ï¼Œåé¢çš„ä»£ç å°±æ¯”è¾ƒå®¹æ˜“ç†è§£äº†ï¼Œå°±æ˜¯è·å–æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡\n\n#### åŠ¨æ€ä»£ç†çš„ä¼˜ç‚¹\n\nä¸å±€é™äºæŸä¸ªç±»ï¼Œå¯ä»¥ä¸ºæœ‰ç›¸åŒéœ€æ±‚çš„ç±»å®ç°åˆ‡é¢é€»è¾‘\n\n#### JDKåŠ¨æ€ä»£ç†å±€é™æ€§\n\nåªèƒ½ä¸ºæ¥å£åˆ›å»ºä»£ç†ï¼Œè¿”å›çš„ä»£ç†å¯¹è±¡ï¼Œä¹Ÿåªèƒ½è½¬æ¢åˆ°æŸä¸ªæ¥å£ç±»å‹\n\n\n### cglib\n\nå¯ä»¥ä¸ºæ²¡æœ‰æ¥å£çš„ç±»åˆ›å»ºä»£ç†ã€‚\n\n#### åŸºæœ¬ç”¨æ³•ç¤ºä¾‹\n\n![](https://gitee.com/jinxin.70/oss/raw/master/uPic/RpCl6V_2021_02_07_16_10_18.png)\n\n- Enhancerç±»çš„setSuperclassè®¾ç½®è¢«ä»£ç†çš„ç±»\n- setCallbackè®¾ç½®è¢«ä»£ç†ç±»çš„publicéfinalæ–¹æ³•è¢«è°ƒç”¨æ—¶çš„å¤„ç†ç±»\n- Enhancerç±»æ”¯æŒå¤šç§ç±»å‹ï¼Œè¿™é‡Œä½¿ç”¨çš„ç±»å®ç°äº†MethodInterceptoræ¥å£\n- è¿™é‡Œè°ƒç”¨è¢«ä»£ç†ç±»çš„æ–¹æ³•åªèƒ½æ˜¯proxy.invokeSuper(object, args)ï¼Œä¸èƒ½æ˜¯method.invoke(object, args)\n\ncglibçš„å®ç°æœºåˆ¶ï¼Œæ˜¯é€šè¿‡**ç»§æ‰¿**å®ç°çš„ï¼ŒåŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»ï¼Œä½†è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯è¢«ä»£ç†ç±»ï¼Œä»£ç†ç±»é‡å†™äº†çˆ¶ç±»çš„æ‰€æœ‰publicéfinalæ–¹æ³•ï¼Œæ”¹ä¸ºè°ƒç”¨Callbackä¸­çš„ç›¸å…³æ–¹æ³•ï¼Œåœ¨ä¸Šä¾‹ä¸­ï¼Œè°ƒç”¨SimpleInterceptorçš„interceptæ–¹æ³•ã€‚\n\n### JDKåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†çš„æ¯”è¾ƒ\n\n- JDKåŠ¨æ€ä»£ç†é¢å‘ä¸€ç»„æ¥å£ï¼Œå®ƒä¸ºè¿™äº›æ¥å£åŠ¨æ€åˆ›å»ºäº†ä¸€ä¸ªå®ç°ç±»ã€‚\n    - æ¥å£çš„å…·ä½“å®ç°é€»è¾‘æ˜¯é€šè¿‡è‡ªå®šä¹‰çš„InvocationHandlerå®ç°çš„\n    - è¿™ä¸ªå®ç°æ˜¯è‡ªå®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶èƒŒåéƒ½ä¸ä¸€å®šæœ‰çœŸæ­£è¢«ä»£ç†çš„å¯¹è±¡ï¼Œä¹Ÿå¯èƒ½æœ‰å¤šä¸ªå®é™…å¯¹è±¡ï¼Œæ ¹æ®æƒ…å†µåŠ¨æ€é€‰æ‹©\n    - **ä»£ç†çš„æ˜¯å¯¹è±¡ï¼Œéœ€è¦å…ˆæœ‰ä¸€ä¸ªå®é™…çš„å¯¹è±¡**ï¼Œè‡ªå®šä¹‰çš„InvocationHandlerå¼•ç”¨è¯¥å¯¹è±¡ï¼Œ\n      ç„¶ååˆ›å»ºä¸€ä¸ªä»£ç†ç±»å’Œä»£ç†å¯¹è±¡ï¼Œå®¢æˆ·ç«¯è®¿é—®çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡æœ€åå†è°ƒç”¨å®é™…å¯¹è±¡çš„æ–¹æ³•\n- cglibä»£ç†é¢å‘ä¸€ä¸ªå…·ä½“çš„ç±»\n    - åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ–°ç±»ï¼Œç»§æ‰¿è¯¥ç±»ï¼Œé‡å†™å…¶æ–¹æ³•\n    - cglibä»£ç†çš„æ˜¯ç±»ï¼Œåˆ›å»ºçš„å¯¹è±¡åªæœ‰ä¸€ä¸ª\n\n## åŠ¨æ€ä»£ç†çš„åº”ç”¨â€”â€”AOP\n\nå®ç°åŸç†\n\n[ä»£ç åœ°å€](https://gitee.com/jinxin.70/alpha1/tree/ce6dbb64df7848548723e9caa981ba6f371b2f0e/java-base/src/main/java/com/kim/base/proxy/aop)\n\n## æ€»ç»“\n\næœ¬æ–‡ä¸»è¦å­¦ä¹ äº†åŠ¨æ€ä»£ç†ï¼Œè¯»å®Œååº”è¯¥çŸ¥é“è¿™äº›å†…å®¹\n\n- ä»€ä¹ˆæ˜¯ä»£ç†\n- ä»€ä¹ˆæ˜¯é™æ€ä»£ç†ï¼Ÿå’Œé€‚é…å™¨ã€è£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ\n- ä¸ºä»€ä¹ˆå®é™…ä½¿ç”¨å¾ˆå°‘ç”¨é™æ€ä»£ç†\n- Javaè¯­è¨€ä¸­åŠ¨æ€ä»£ç†çš„ä¸¤ç§æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿå†…éƒ¨æ˜¯å¦‚ä½•å»å®ç°çš„ï¼Ÿ\n- åŠ¨æ€ä»£ç†å¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿ\n\nåŸºæœ¬ä¸Šæ˜¯å±‚å±‚é€’è¿›ï¼Œåˆ°æœ€åï¼ŒåŠ¨æ€ä»£ç†çš„å…¸å‹åº”ç”¨AOPï¼Œå¯ä»¥è¯´æ˜¯å¾ˆå¤šæ¡†æ¶çš„åŸºç¡€ï¼Œå¿…é¡»æŒæ¡å…¶åŸç†ã€‚","tags":["Java","åŠ¨æ€ä»£ç†"],"categories":["Java","åŠ¨æ€ä»£ç†"]},{"title":"é€‰æ‹©æ’åº","url":"/2021/02/12/selection-sort/","content":"\n## æ’åºè¿‡ç¨‹\n\nå‡å¦‚å¯¹å¦‚ä¸‹æ•°ç»„æ’åº\n\n![image-20210212212637607](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212212637607_2021_02_12_21_26_37.png)\n\næˆ‘ä»¬æ‰“ç®—ä»å°åˆ°å¤§æ’åº\n\n### ç¬¬ä¸€è½®\n\nå…ˆæ‰¾åˆ°æ•°ç»„ä¸­æœ€å°çš„ï¼Œæ˜¯1\n\n![image-20210212212805249](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212212805249_2021_02_12_21_28_05.png)\n\nç„¶åå°†1å’Œæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªä½ç½®ä¸Šçš„æ•°äº¤æ¢ï¼Œè¿™æ ·ï¼Œ1å°±æ˜¯æœ€ç»ˆçš„ä½ç½®äº†\n\n![image-20210212212837283](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212212837283_2021_02_12_21_28_37.png)\n\n### ç¬¬äºŒè½®\n\né‚£ä¹ˆ1æ’å¥½äº†ï¼Œæˆ‘ä»¬ä»å‰©ä¸‹çš„æ•°é‡Œé¢æ‰¾æœ€å°çš„æ•°ï¼Œæ˜¯2\n\n![image-20210212212905854](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212212905854_2021_02_12_21_29_06.png)\n\næˆ‘ä»¬å°†2å’Œç¬¬äºŒä¸ªä½ç½®ä¸Šçš„æ•°äº¤æ¢ä½ç½®\n\n![image-20210212213045447](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213045447_2021_02_12_21_30_45.png)\n\næ­¤æ—¶ï¼Œ1å’Œ2éƒ½å·²ç»å›ºå®šå¥½äº†ä½ç½®\n\n![image-20210212213108930](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213108930_2021_02_12_21_31_09.png)\n\n### ç¬¬ä¸‰è½®\n\nå†ä»ç¬¬ä¸‰ä¸ªä½ç½®å¾€åæ‰¾æœ€å°çš„æ•°ï¼Œç„¶åä¸ç¬¬ä¸‰ä¸ªä½ç½®ä¸Šçš„æ•°äº¤æ¢ä½ç½®\n\n![image-20210212213214529](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213214529_2021_02_12_21_32_14.png)\n\n![image-20210212213226904](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213226904_2021_02_12_21_32_27.png)\n\nä¾æ­¤ç±»æ¨ï¼Œæ‰¾åˆ°æ•°ç»„æœ«å°¾å°±æ’å¥½åºäº†\n\n### ç¬¬å››è½®\n\n![image-20210212213300337](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213300337_2021_02_12_21_33_00.png)\n\n![image-20210212213317201](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213317201_2021_02_12_21_33_17.png)\n\n### ç¬¬äº”è½®\n\n![image-20210212213342282](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213342282_2021_02_12_21_33_42.png)\n\n![image-20210212213355567](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213355567_2021_02_12_21_33_55.png)\n\n### ç¬¬å…­è½®\n\n![image-20210212213442090](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213442090_2021_02_12_21_34_42.png)\n\n![image-20210212213453305](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213453305_2021_02_12_21_34_53.png)\n\n### ç¬¬ä¸ƒè½®\n\n![image-20210212213512606](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213512606_2021_02_12_21_35_12.png)\n\n### ç¬¬å…«è½®\n\n![image-20210212213535214](https://gitee.com/jinxin.70/oss/raw/master/uPic/image-20210212213535214_2021_02_12_21_35_35.png)\n\n## C++å®ç°\n\n```c++\n#include <iostream>\n\nusing namespace std;\n/**\n * é€‰æ‹©æ’åº\n * @param arr\n * @param n\n */\nvoid selectionSort(int arr[], int n){\n    for (int i = 0; i < n; ++i) {\n        //å¯»æ‰¾[1,n)åŒºé—´é‡Œçš„æœ€å°å€¼\n        int minIndex = i;\n        for (int j = i + 1; j < n; ++j) {\n            if(arr[j] < arr[minIndex]){\n                minIndex = j;\n            }\n        }\n        swap(arr[i], arr[minIndex]);\n    }\n}\n\nint main(){\n    int a[10] = {10,9,8,7,6,5,4,3,2,1};\n    selectionSort(a, 10);\n\n    for (int i = 0; i < 10; ++i) {\n        cout<<a[i]<<\" \";\n    }\n    cout<<endl;\n    return 0;\n}\n```\n\n\n\n## ä½¿ç”¨æ¨¡æ¿ï¼ˆèŒƒå‹ï¼‰ç¼–å†™ç®—æ³•\n\nä¸Šé¢çš„å®ç°ï¼Œåªèƒ½å¯¹intæ•°ç»„æ’åºï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸åŒçš„ç±»å‹æ’åºï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°æ¨¡æ¿ï¼Œæœ‰çš„è¯­è¨€å«èŒƒå‹ã€‚\n\n**Student.h**\n\n```c++\n\n#ifndef ALGORITHMCPLUSPLUS_STUDENT_H\n#define ALGORITHMCPLUSPLUS_STUDENT_H\n\n#include <iostream>\n#include <string>\n\nusing namespace std;\n\nstruct Student{\n    string name;\n    int score;\n\n    // é‡è½½å°äºè¿ç®—æ³•,å®šä¹‰Studentä¹‹é—´çš„æ¯”è¾ƒæ–¹å¼\n    // å¦‚æœåˆ†æ•°ç›¸ç­‰ï¼Œåˆ™æŒ‰ç…§åå­—çš„å­—æ¯åºæ’åº\n    // å¦‚æœåˆ†æ•°ä¸ç­‰ï¼Œåˆ™åˆ†æ•°é«˜çš„é å‰\n    bool operator<(const Student& otherStudent){\n        return score != otherStudent.score ?\n               score > otherStudent.score : name < otherStudent.name;\n    }\n\n    // é‡è½½<<ç¬¦å·, å®šä¹‰Studentå®ä¾‹çš„æ‰“å°è¾“å‡ºæ–¹å¼\n    // * å¾ˆå¤šåŒå­¦çœ‹åˆ°è¿™é‡Œçš„C++è¯­æ³•, å¤´å°±å¤§äº†, ç”šè‡³è¿˜æœ‰åŒå­¦è¡¨ç¤ºè¦é‡æ–°å­¦ä¹ C++è¯­è¨€\n    // * å¯¹äºè¿™ä¸ªè¯¾ç¨‹, å¤§å¯ä¸å¿…ã€‚C++è¯­è¨€å¹¶ä¸æ˜¯è¿™ä¸ªè¯¾ç¨‹çš„é‡ç‚¹,\n    // * å¤§å®¶ä¹Ÿå®Œå…¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„æ–¹å¼ä¹¦å†™ä»£ç , æœ€ç»ˆåªè¦èƒ½å¤Ÿæ‰“å°å‡ºç»“æœå°±å¥½äº†, æ¯”å¦‚è®¾ç½®ä¸€ä¸ªæˆå‘˜å‡½æ•°, å«åšshow()...\n    // * æ¨èå¤§å®¶é˜…è¯»æˆ‘åœ¨é—®ç­”åŒºå‘å¤§å®¶åˆ†äº«çš„ä¸€ä¸ªå­¦ä¹ å¿ƒå¾—: ã€å­¦ä¹ å¿ƒå¾—åˆ†äº«ã€‘è¯·å¤§å®¶æŠ“å¤§æ”¾å°ï¼Œä¸è¦çº ç»“äºC++è¯­è¨€çš„è¯­æ³•ç»†èŠ‚\n    // * é“¾æ¥: http://coding.imooc.com/learn/questiondetail/4100.html\n    friend ostream& operator<<(ostream &os, const Student &student){\n\n        os<<\"Student: \"<<student.name<<\" \"<<student.score<<endl;\n        return os;\n    }\n};\n\n#endif //ALGORITHMCPLUSPLUS_STUDENT_H\n```\n\n**main.cpp**\n\n```c++\n#include <iostream>\n\nusing namespace std;\n#include \"Student.h\"\ntemplate<typename T>\n/**\n * é€‰æ‹©æ’åº\n * @param arr\n * @param n\n */\nvoid selectionSort(T arr[], int n){\n    for (int i = 0; i < n; ++i) {\n        //å¯»æ‰¾[1,n)åŒºé—´é‡Œçš„æœ€å°å€¼\n        int minIndex = i;\n        for (int j = i + 1; j < n; ++j) {\n            if(arr[j] < arr[minIndex]){\n                minIndex = j;\n            }\n        }\n        swap(arr[i], arr[minIndex]);\n    }\n}\n\nint main(){\n    int a[10] = {10,9,8,7,6,5,4,3,2,1};\n    selectionSort(a, 10);\n\n    for (int i = 0; i < 10; ++i) {\n        cout<<a[i]<<\" \";\n    }\n    cout<<endl;\n\n    float b[4] = {4.4,3.3,2.2,1.1};\n    selectionSort(b, 4);\n    for (int i = 0; i < 4; ++i) {\n        cout<<b[i]<< \" \";\n    }\n    cout<<endl;\n\n    string c[4] = {\"D\",\"C\",\"B\",\"A\"};\n    selectionSort(c,4);\n    for( int i = 0 ; i < 4 ; i ++ )\n        cout<<c[i]<<\" \";\n    cout<<endl;\n\n    Student d[4] = { {\"D\",90} , {\"C\",100} , {\"B\",95} , {\"A\",95} };\n    selectionSort(d,4);\n    for( int i = 0 ; i < 4 ; i ++ )\n        cout<<d[i];\n    cout<<endl;\n    return 0;\n}\n```\n\n## éšæœºç”Ÿæˆç®—æ³•æµ‹è¯•ç”¨ä¾‹ï¼ˆé€‰å­¦ï¼‰\n\næ€è€ƒğŸ¤”ï¼š\n\næˆ‘ä»¬ä¸Šé¢ä»£ç çš„æµ‹è¯•ç”¨ä¾‹æ˜¯ç¡¬ç¼–ç çš„ï¼Œæˆ‘ä»¬å¸Œæœ›ç”Ÿæˆè‡ªåŠ¨ç”Ÿæˆã€‚\n\n**SortTestHelper.h**\n\n```c++\n#ifndef ALGORITHMCPLUSPLUS_SORTTESTHELPER_H\n#define ALGORITHMCPLUSPLUS_SORTTESTHELPER_H\n#include <iostream>\n#include <ctime>\n#include <cassert>\n\nusing namespace std;\n\nnamespace SortTestHelper {\n// ç”Ÿæˆæœ‰nä¸ªå…ƒç´ çš„éšæœºæ•°ç»„,æ¯ä¸ªå…ƒç´ çš„éšæœºèŒƒå›´ä¸º[rangeL, rangeR]\n    int *generateRandomArray(int n, int rangeL, int rangeR) {\n\n        assert(rangeL <= rangeR);\n\n        int *arr = new int[n];\n\n        srand(time(NULL));\n        for (int i = 0; i < n; i++)\n            arr[i] = rand() % (rangeR - rangeL + 1) + rangeL;\n        return arr;\n    }\n\n    // æ‰“å°arræ•°ç»„çš„æ‰€æœ‰å†…å®¹\n    template<typename T>\n    void printArray(T arr[], int n) {\n\n        for (int i = 0; i < n; i++)\n            cout << arr[i] << \" \";\n        cout << endl;\n\n        return;\n    }\n  // åˆ¤æ–­arræ•°ç»„æ˜¯å¦æœ‰åº\n    template<typename T>\n    bool isSorted(T arr[], int n) {\n\n        for (int i = 0; i < n - 1; i++)\n            if (arr[i] > arr[i + 1])\n                return false;\n\n        return true;\n    }\n\n    // æµ‹è¯•sortæ’åºç®—æ³•æ’åºarræ•°ç»„æ‰€å¾—åˆ°ç»“æœçš„æ­£ç¡®æ€§å’Œç®—æ³•è¿è¡Œæ—¶é—´\n    // * ä½¿ç”¨VSç¼–ç çš„åŒå­¦, å¯¹äºå‡½æ•°æŒ‡é’ˆçš„å†™æ³•å’Œè°ƒç”¨æ–¹æ³•å¯èƒ½å’Œè¯¾ç¨‹ä¸­ä»‹ç»çš„æœ‰æ‰€ä¸åŒ;\n    // * å¹¶ä¸”ä¸åŒç‰ˆæœ¬çš„VS, å…¶å…·ä½“è¯­æ³•å¯èƒ½ä¹Ÿæœ‰å·®å¼‚, è¿™æ˜¯å› ä¸ºVSçš„ç¼–è¯‘å™¨ä¸å®Œå…¨æ˜¯æŒ‰ç…§C++çš„æ ‡å‡†å®ç°çš„;\n    // * æœ¬è¯¾ç¨‹æŒ‰ç…§C++11çš„æ ‡å‡†è¿›è¡Œä¹¦å†™ã€‚å¯¹äºVSç¼–è¯‘å™¨å¸¦æ¥çš„è¯­æ³•å·®å¼‚, å¸Œæœ›åŒå­¦ä»¬å¯ä»¥è‡ªå·±åœ¨ç½‘ä¸ŠæŸ¥æ‰¾ç›¸å…³èµ„æ–™è§£å†³;\n    // * å¤§å®¶ä¹Ÿå¯ä»¥åœ¨è¯¾ç¨‹çš„å®˜æ–¹QQç¾¤ä¸­äº¤æµ\n    // * å¦å¤–, ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæœ¬èº«å¹¶ä¸æ˜¯è¿™ä¸ªè¯¾ç¨‹çš„é‡ç‚¹, å¤§å®¶ä¹Ÿå®Œå…¨å¯ä»¥ä½¿ç”¨è‡ªå·±çš„æ–¹å¼ä¹¦å†™ä»£ç , æœ€ç»ˆåªè¦èƒ½å¤Ÿæµ‹è¯•å‡ºè‡ªå·±ä¹¦å†™çš„ç®—æ³•çš„æ•ˆç‡å³å¯\n    // * æ¨èå¤§å®¶é˜…è¯»æˆ‘åœ¨é—®ç­”åŒºå‘å¤§å®¶åˆ†äº«çš„ä¸€ä¸ªå­¦ä¹ å¿ƒå¾—: ã€å­¦ä¹ å¿ƒå¾—åˆ†äº«ã€‘è¯·å¤§å®¶æŠ“å¤§æ”¾å°ï¼Œä¸è¦çº ç»“äºC++è¯­è¨€çš„è¯­æ³•ç»†èŠ‚\n    // * é“¾æ¥: http://coding.imooc.com/learn/questiondetail/4100.html\n    template<typename T>\n    void testSort(const string &sortName, void (*sort)(T[], int), T arr[], int n) {\n\n        clock_t startTime = clock();\n        sort(arr, n);\n        clock_t endTime = clock();\n\n        assert(isSorted(arr, n));\n        cout << sortName << \" : \" << double(endTime - startTime) / CLOCKS_PER_SEC << \" s\" << endl;\n//CLOCKS_PER_SECè¡¨ç¤ºæ¯ç§’è¿è¡Œçš„æ—¶é—´å‘¨æœŸæ•°\n        return;\n    }\n};\n#endif //ALGORITHMCPLUSPLUS_SORTTESTHELPER_H\n```\n\ntestSortå‡½æ•°çš„å…¥å‚void (*sort)(T[], int)æ˜¯å¯¹ä¸€ä¸ªå‡½æ•°çš„å£°æ˜ï¼Œå…¶ä¸­\n\n- void æ˜¯è¿”å›å€¼ï¼Œè¡¨ç¤ºè¿”å›void\n\n- *sortæ˜¯å‡½æ•°æŒ‡é’ˆ\n\n- (T[], int)è¡¨ç¤ºå‚æ•°ï¼ŒTæ•°ç»„å’Œintç±»å‹å˜é‡è¡¨ç¤ºé•¿åº¦\n\nå¹¶ä¸”åœ¨å‡½æ•°å£°æ˜ä¸Šæ–¹è¦å¯¹Tè¿›è¡Œå£°æ˜ï¼Œtemplate<typename T>\n\n**main.cpp**\n\n```c++\n#include <iostream>\n#include \"SortTestHelper.h\"\n\nusing namespace std;\n\ntemplate<typename T>\nvoid selectionSort(T arr[], int n){\n\n    for(int i = 0 ; i < n ; i ++){\n\n        int minIndex = i;\n        for( int j = i + 1 ; j < n ; j ++ )\n            if( arr[j] < arr[minIndex] )\n                minIndex = j;\n\n        swap( arr[i] , arr[minIndex] );\n    }\n}\n\nint main() {\n\n    // æµ‹è¯•æ’åºç®—æ³•è¾…åŠ©å‡½æ•°\n    int N = 20000;\n    int *arr = SortTestHelper::generateRandomArray(N,0,100000);\n    selectionSort(arr,N);\n    SortTestHelper::printArray(arr,N);\n    delete[] arr;\n\n    return 0;\n}\n```\n","tags":["ç®—æ³•","C++"],"categories":["Algorithm","C++"]},{"title":"ç±»åŠ è½½æœºåˆ¶","url":"/2021/02/09/ç±»åŠ è½½æœºåˆ¶/","content":"\n## ç±»åŠ è½½å™¨å¯ä»¥åšä»€ä¹ˆ\n\n### çƒ­éƒ¨ç½²\n\nä¸é‡å¯Javaç¨‹åºçš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€æ›¿æ¢ç±»çš„å®ç°\n\næ¯”å¦‚JSPã€OSGI\n\n### åº”ç”¨çš„æ¨¡å—åŒ–å’Œéš”ç¦»\n\nä¸åŒçš„ç±»åŠ è½½å™¨å¯ä»¥åŠ è½½ç›¸åŒçš„ç±»ï¼Œä½†äº’ç›¸éš”ç¦»ã€äº’ä¸å½±å“\n\næ¯”å¦‚ï¼š\n\n- Tomcatåœ¨ä¸€ä¸ªç¨‹åºä¸­ç®¡ç†å¤šä¸ªWebåº”ç”¨ï¼Œæ¯ä¸ªWebåº”ç”¨æœ‰è‡ªå·±çš„classloader\n- OSGIå’ŒJava9å®ç°åŠ¨æ€æ¨¡å—åŒ–æ¶æ„ï¼Œæ¯ä¸ªæ¨¡å—æœ‰è‡ªå·±çš„ClassLoader\n\n### å¯ä»¥ä»ä¸åŒçš„åœ°æ–¹çµæ´»åŠ è½½ç±»\n\n## ä¸ºä»€ä¹ˆè¦å­¦è‡ªå®šä¹‰classloader\n\n- æœ‰åŠ©äºæˆ‘ä»¬ç†è§£ç›¸å…³çš„ç³»ç»Ÿå’Œæ¡†æ¶ï¼Œæ¯”å¦‚Tomcat\n- åœ¨ä¸šåŠ¡éœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥è‡ªå®šä¹‰classloaderå®ç°åŠ¨æ€çµæ´»çš„åŠŸèƒ½\n\n## ç±»åŠ è½½çš„åŸºæœ¬æœºåˆ¶å’Œè¿‡ç¨‹\n\né¦–å…ˆäº†è§£ä¸‹ï¼ŒJDKæä¾›çš„å‡ ä¸ªç±»åŠ è½½å™¨\n\n- å¯åŠ¨ç±»åŠ è½½å™¨ã€‚åŠ è½½åŸºç¡€ç±»ï¼Œä¸»è¦æ˜¯rt.jar\n- æ‰©å±•ç±»åŠ è½½å™¨ã€‚åŠ è½½extç›®å½•ä¸‹çš„jar\n- åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚åŠ è½½åº”ç”¨ç¨‹åºçš„ç±»ï¼ŒåŒ…æ‹¬è‡ªå·±å†™çš„å’Œå¼•å…¥çš„ç¬¬ä¸‰æ–¹æ³•ç±»åº“\n\nè¦ç‚¹ï¼šç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»ï¼Œä¸æ˜¯ç»§æ‰¿å…³ç³»ï¼Œæ˜¯å§”æ´¾å…³ç³»ã€‚\n\n### åŠ è½½è¿‡ç¨‹\n\n1. åˆ¤æ–­ç±»æ˜¯å¦åŠ è½½è¿‡äº†ï¼Œæ²¡æœ‰å°±ä¸€å±‚å±‚å‘ä¸Šå§”æ´¾ç»™çˆ¶ç±»ï¼Œæœ€åå…ˆè®©å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½\n2. å¯åŠ¨ç±»åŠ è½½åˆ°äº†ï¼Œå°±è¿”å›Classå¯¹è±¡ï¼Œå¦åˆ™å°±è®©extåŠ è½½å™¨åŠ è½½\n3. extåŠ è½½å™¨åŠ è½½åˆ°äº†ï¼Œå°±è¿”å›Classå¯¹è±¡ï¼Œå¦åˆ™å°±è®©åº”ç”¨ç±»åŠ è½½å™¨åŠ è½½\n4. åº”ç”¨ç±»åŠ è½½å™¨åŠ è½½åˆ°äº†ï¼Œå°±è¿”å›Classå¯¹è±¡ï¼Œå¦åˆ™è¿”å›æŠ›å¼‚å¸¸\n\nä¸Šé¢çš„åŠ è½½è¿‡ç¨‹å°±æ˜¯åŒäº²å§”æ´¾ï¼Œä¸€ä¸ªç±»åŠ è½½æ—¶ï¼Œå§”æ´¾ç»™extç±»åŠ è½½å™¨ï¼Œå†å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨\n\nè¿™æ ·å¯ä»¥é¿å…JavaåŸºç¡€ç±»åº“è¢«è¦†ç›–\n\nJDKå…è®¸ä¸éµå¾ªä¸Šé¢çš„åŠ è½½è¿‡ç¨‹ï¼Œæ‰“ç ´åŒäº²å§”æ´¾è§„åˆ™ï¼š\n\n- è‡ªå®šä¹‰çš„åŠ è½½é¡ºåº\n  - å³ä½¿ä¸éµå®ˆåŒäº²å§”æ´¾ï¼Œä»¥javaå¼€å¤´çš„ç±»ä¹Ÿä¸èƒ½è¢«è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™æ˜¯ç”±Javaçš„å®‰å…¨æœºåˆ¶ä¿è¯çš„ï¼Œä»¥é¿å…æ··ä¹±ã€‚\n- ç½‘çŠ¶åŠ è½½é¡ºåº\n  - OSGIå’ŒJava9æ¨¡å—åŒ–ç³»ç»Ÿï¼Œç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»æ˜¯ä¸€ä¸ªç½‘ï¼Œæ¯ä¸ªæ¨¡å—æœ‰ä¸€ä¸ªç±»åŠ è½½å™¨\n- çˆ¶åŠ è½½å™¨å§”æ´¾ç»™å­åŠ è½½å™¨åŠ è½½\n  - JNDIæœåŠ¡\n\n## ç†è§£ClassLoader\n\nClassLoaderç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚\n\næœ‰ä¸¤ä¸ªå­ç±»\n\n- AppClassLoader\n- ExtClassLoader\n\nBootstrapClassLoaderå¹¶ä¸æ˜¯å®ƒçš„å­ç±»ï¼ŒBootstrapClassLoaderæ˜¯C++å†™çš„ï¼Œç”¨äºåŠ è½½javaåŸºç¡€ç±»çš„ã€‚\n\n### Classå¯¹è±¡çš„API\n\n#### getClassLoader\n\ngetClassLoaderè·å–ClassLoaderï¼Œæ¥çœ‹çœ‹ClassLoaderçš„API\n\n- getParent\n  - å¦‚æœparentæ˜¯Bootstrap ClassLoaderï¼Œè¿”å›å€¼ä¸ºnull\n- é™æ€æ–¹æ³•getSystemClassLoader\n  - è·å–é»˜è®¤çš„ç³»ç»Ÿç±»æœºè½½å™¨\n- loadeClassæ–¹æ³•\n  - ![ç¤ºä¾‹](https://gitee.com/jinxin.70/oss/raw/master/uPic2/VulpSW.png)\n- æ·±å…¥loadClassæ–¹æ³•\n  - ![](https://gitee.com/jinxin.70/oss/raw/master/uPic2/6HvGpS.png)\n\n#### Class.forName\n\n![](https://gitee.com/jinxin.70/oss/raw/master/uPic2/jqjhdq.png)\n\n- ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½\n- ç¬¬äºŒä¸ªæ–¹æ³•ï¼ŒæŒ‡å®šClassLoaderï¼Œå‚æ•°initializeè¡¨ç¤ºåŠ è½½åæ˜¯å¦æ‰§è¡Œç±»çš„åˆå§‹åŒ–ä»£ç ï¼ˆå¦‚staticä»£ç å—ï¼‰ï¼Œæ²¡æœ‰æŒ‡å®šé»˜è®¤trueã€‚\n\nClass.forNameå’ŒClassLoaderçš„loadClassæ–¹æ³•éƒ½èƒ½åŠ è½½ç±»\n\nä¸åŒç‚¹ï¼šClassLoaderçš„loadClassæ–¹æ³•ä¸ä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–ä»£ç \n\n```java\npublic class CLInitDemo {\n    public static class Hello {\n        static {\n            System.out.println(\"hello\");\n        }\n    };\n\n    public static void main(String[] args) {\n        ClassLoader cl = ClassLoader.getSystemClassLoader();\n        String className = CLInitDemo.class.getName() + \"$Hello\";\n        try {\n            //ä¸ä¼šåˆå§‹åŒ–ç±»ï¼Œä¸ä¼šæ‰§è¡Œé™æ€æ–¹æ³•å’Œä»£ç å—\n\t\t\tClass<?> cls = cl.loadClass(className);\n\t\t\t//ä¼šåˆå§‹åŒ–ç±»ï¼Œä¼šæ‰§è¡Œé™æ€æ–¹æ³•å’Œé™æ€ä»£ç å—\n//            Class<?> cls = Class.forName(className);\n        } catch (ClassNotFoundException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n## ç±»åŠ è½½å™¨çš„åº”ç”¨ï¼šå¯é…ç½®çš„ç­–ç•¥\n\nç­–ç•¥æ¨¡å¼ï¼Œå°†ä¸åŒç­–ç•¥å®ç°ç±»ï¼Œé…ç½®åœ¨å¤–éƒ¨æ–‡ä»¶ä¸­ï¼Œä¸åŒåœºåˆä½¿ç”¨ä¸åŒçš„é…ç½®ï¼Œé€šè¿‡åå°„ã€ç±»åŠ è½½å™¨åŠ è½½é…ç½®ä¸­çš„ç±»ã€‚ä¸éœ€è¦æ”¹ä»£ç å°±å¯ä»¥æ”¹å˜ç¨‹åºçš„è¡Œä¸º\n\n[ä»£ç åœ°å€](https://gitee.com/jinxin.70/alpha1/commit/5fa782b61f350874eaa919c397fa21630911fb40)\n\n## è‡ªå®šä¹‰ClassLoader\n\n### ä¸€èˆ¬æ­¥éª¤\n\n1. ç»§æ‰¿ClassLoader\n2. é‡å†™findClass\n    1. ä»classæ–‡ä»¶ä½ç½®åŠ è½½ç±»\n    2. è½¬æˆå­—èŠ‚æ•°ç»„\n    3. è°ƒç”¨defineClassæ–¹æ³•\n\n### æ¡ˆä¾‹\n\n```java\npublic class MyClassLoader extends ClassLoader{\n    private static final String BASE_DIR = \"data/classloader/\";\n\n    @Override\n    protected Class<?> findClass(String name) throws ClassNotFoundException {\n        String fileName = name.replaceAll(\"\\\\.\", \"/\");\n        fileName = BASE_DIR + fileName + \".class\";\n        try {\n            byte[] bytes = BinaryFileUtils.readFileToByteArray(fileName);\n            return defineClass(name, bytes, 0, bytes.length);\n        } catch (IOException ex) {\n            throw new ClassNotFoundException(\"failed to load class \" + name, ex);\n        }\n    }\n}\n```\n\n### è‡ªå®šä¹‰äº†ç±»åŠ è½½å™¨ä¹‹åå‘¢ï¼Ÿèƒ½å¹²å˜›ï¼Ÿ\n\n- å¯ä»¥åˆ›å»ºå¤šä¸ªMyClassLoaderï¼Œå¯¹åŒä¸€ä¸ªç±»ï¼Œæ¯ä¸ªMyClassLoaderéƒ½å¯ä»¥åŠ è½½ä¸€æ¬¡ï¼Œå¾—åˆ°åŒä¸€ä¸ªç±»å¯¹ä¸åŒClasså¯¹è±¡\n- å¯ä»¥å®ç°éš”ç¦»\n    - ä¸åŒæ¨¡å—ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨\n- å¯ä»¥å®ç°çƒ­éƒ¨ç½²\n    - ä½¿ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ŒåŠ è½½Classï¼Œå¾—åˆ°çš„å°±æ˜¯æ–°çš„ï¼Œä»è€Œå¯ä»¥å®ç°åŠ¨æ€æ›´æ–°\n\n### çƒ­éƒ¨ç½²å®éªŒ\n\n```java\npublic class HotDeployDemo {\n    /**\n     * å®ç°ç±»åç§°\n     */\n    private static final String CLASS_NAME = \"com.kim.base.classloader.custom.HelloImpl\";\n    /**\n     * classæ–‡ä»¶è·¯å¾„\n     */\n    private static final String FILE_NAME = \"target/classes/\"\n            +CLASS_NAME.replaceAll(\"\\\\.\", \"/\")+\".class\";\n    /**\n     * IHelloServiceå®ç°ç±»\n     */\n    private static volatile IHelloService helloService;\n\n    public static IHelloService getHelloService() {\n        if (helloService != null) {\n            return helloService;\n        }\n        synchronized (HotDeployDemo.class) {\n            if (helloService == null) {\n                helloService = createHelloService();\n            }\n            return helloService;\n        }\n    }\n\n    /**\n     * é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œä»æŒ‡å®šçš„ç›®å½•åŠ è½½IHelloServiceå®ç°ç±»\n     * @return\n     */\n    private static IHelloService createHelloService() {\n        try {\n            MyClassLoader cl = new MyClassLoader();\n            Class<?> cls = cl.loadClass(CLASS_NAME);\n            if (cls != null) {\n                return (IHelloService) cls.newInstance();\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n    public static void client() {\n        Thread t = new Thread() {\n            @Override\n            public void run() {\n                try {\n                    while (true) {\n                        IHelloService helloService = getHelloService();\n                        helloService.sayHello();\n                        Thread.sleep(1000);\n                    }\n                } catch (InterruptedException e) {\n                }\n            }\n        };\n        t.start();\n    }\n\n    /**\n     * ä¸€ä¸ªç›‘è§†æ–‡ä»¶å˜åŒ–çš„çº¿ç¨‹ï¼Œæ–‡ä»¶å¦‚æœå˜åŒ–äº†ï¼Œå°±é‡æ–°åŠ è½½\n     */\n    public static void monitor() {\n        Thread t = new Thread() {\n            private long lastModified = new File(FILE_NAME).lastModified();\n\n            @Override\n            public void run() {\n                try {\n                    while (true) {\n                        Thread.sleep(100);\n                        long now = new File(FILE_NAME).lastModified();\n                        if (now != lastModified) {\n                            lastModified = now;\n                            reloadHelloService();\n                        }\n                    }\n                } catch (InterruptedException e) {\n                }\n            }\n        };\n        t.start();\n    }\n\n    public static void reloadHelloService() {\n        System.out.println(\"æ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œé‡æ–°åŠ è½½\");\n        helloService = createHelloService();\n    }\n\n    public static void main(String[] args) {\n        monitor();\n        client();\n    }\n}\n```\n\n- æˆ‘ä»¬æŠŠåˆ›å»ºHelloServiceçš„å®ç°çš„æ–¹å¼æå–å‡ºæ¥ï¼Œé€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œåœ¨æŒ‡å®šç›®å½•åŠ è½½ä»–çš„å®ç°\n- æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œç›‘å¬è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½ç±»çš„åœ°æ–¹ï¼Œç›‘å¬å…·ä½“æ–‡ä»¶çš„å˜åŒ–ï¼Œæœ‰å˜åŒ–å°±é‡æ–°å®ä¾‹åŒ–ä¸€ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ŒåŠ è½½æ–°çš„ç±»ï¼Œä½¿å…¶ç”Ÿæ•ˆ\n- æ¨¡æ‹Ÿå®¢æˆ·ç«¯è°ƒç”¨\n    - ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ— é™å¾ªç¯å»è°ƒç”¨helloServicveçš„æ–¹æ³•sayHello\n\n## æ€»ç»“\n\né€šè¿‡ç±»åŠ è½½å™¨çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“äº†ç±»åŠ è½½å™¨æœ€èµ·ç å¯ä»¥åšå¦‚ä¸‹ä¸‰æ ·äº‹æƒ…ï¼š\n\n1. çƒ­éƒ¨ç½²\n2. åº”ç”¨çš„æ¨¡å—åŒ–å’Œéš”ç¦»\n3. ä»ä¸åŒçš„åœ°æ–¹çµæ´»åŠ è½½\n\næˆ‘ä»¬ä½¿ç”¨çš„tomcatå°±æ˜¯ä½¿ç”¨ç±»åŠ è½½å™¨çš„å…¸å‹ä¾‹å­ï¼Œé€šè¿‡æ¡ˆä¾‹å’Œå®éªŒä»£ç çš„è¿è¡Œã€è°ƒè¯•ã€ç†è§£ï¼Œå¯¹ç±»åŠ è½½å™¨çš„åº”ç”¨åº”è¯¥ä¼šæœ‰æ›´æ·±çš„ç†è§£ï¼Œå¯¹tomcatçš„è¿è¡Œæœºåˆ¶ä¹Ÿä¸ä¼šè§‰å¾—é‚£ä¹ˆç¥ç§˜ã€‚\n\nè¯»è€…è‡ªå·±å¯ä»¥è¯•è¯•å®ç°ä¸€ä¸ªç®€å•çš„tomcatï¼Œå¯ä»¥å®ç°çƒ­éƒ¨ç½²ã€åº”ç”¨çš„éš”ç¦»ã€‚\n\n","tags":["Java","ç±»åŠ è½½å™¨"],"categories":["Java","ClassLoader"]},{"title":"æˆ‘åº”è¯¥å†™ä»€ä¹ˆ","url":"/2021/02/08/æˆ‘åº”è¯¥å†™ä»€ä¹ˆ/","content":"\næŠ˜è…¾äº†ä¸€å¤©ï¼Œé‡æ–°æŠŠhexoåšå®¢å»ºå¥½äº†\n\n\n\nä¸æƒ³å†æŠ˜è…¾äº†\n\n\n\næ‰“ç®—è¦å†™çš„å†…å®¹ï¼Œè®¡åˆ’ç”¨åšå®¢æ¥åšä»€ä¹ˆ\n\n- è®°å½•å­¦ä¹ è¿‡ç¨‹ï¼Œä¸»è¦è®°å½•è¯»ä¹¦ç¬”è®°ã€æ€ç»´å¯¼å›¾çš„æ€»ç»“ã€æ•™ç¨‹çš„æ€»ç»“ï¼ˆJavaã€åˆ†å¸ƒå¼å¾®æœåŠ¡ã€æ•°æ®å­˜å‚¨ã€ç®—æ³•ã€ä¸­é—´ä»¶æºç æ¶æ„è®¾è®¡ï¼‰\n- è®°å½•æ’æŸ¥é—®é¢˜çš„è¿‡ç¨‹\n- è®°å½•ç”Ÿæ´»ä¸­çš„æƒ³æ³•ï¼ˆæ—…æ¸¸ã€å¸¦å¨ƒã€ç”Ÿæ´»ä¹ æƒ¯å…»æˆã€è¿åŠ¨ï¼‰\n\n\n\nä¸è¯¥å†™çš„å†…å®¹\n\n- ä¸è¯¥å½“ä½œå¤‡å¿˜å½•\n- ä¸å†™æ²¡æœ‰ä½“ç³»ï¼Œä¸å†™æŠ€æœ¯ã€ç”Ÿæ´»æ— å…³çš„å†…å®¹\n\n\n\nåšå®¢åº”è¯¥å…·å¤‡çš„èƒ½åŠ›\n\n- å­—æ•°ç»Ÿè®¡\n- è®¿é—®ç»Ÿè®¡\n- è¯„è®ºç³»ç»Ÿ\n- ä¸ªäººç®€ä»‹ã€ç»å†ï¼ˆè®©åˆ«äººè®¤è¯†ä½ ï¼‰\n\n\n\næ¥ä¸‹æ¥ï¼ŒæŠŠä¸Šé¢åšå®¢çš„èƒ½åŠ›å®ç°ï¼Œç„¶åä»Javaã€ç®—æ³•å¼€å§‹\n\n","tags":["Diary","Life"],"categories":["Diary","Life"]}]